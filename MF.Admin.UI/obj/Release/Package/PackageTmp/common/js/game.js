var gamesconfig = [
    { "ID": 1, "TopID": 0, "Name": "眉山贰柒拾" },
    { "ID": 2, "TopID": 0, "Name": "乐山贰柒拾" },
    { "ID": 3, "TopID": 0, "Name": "犍为贰柒拾" },
    { "ID": 4, "TopID": 0, "Name": "十四张三人" },
    { "ID": 5, "TopID": 0, "Name": "十四张四人" },
    { "ID": 6, "TopID": 0, "Name": "十四张四人(血战)" },
    { "ID": 7, "TopID": 0, "Name": "两人贰柒拾(犍为)" },
    { "ID": 8, "TopID": 0, "Name": "两人贰柒拾(乐山)" },
    { "ID": 9, "TopID": 0, "Name": "两人贰柒拾(眉山)" },
    { "ID": 10, "TopID": 0, "Name": "四川麻将" },
    { "ID": 11, "TopID": 0, "Name": "四川麻将(血流)" },
    { "ID": 12, "TopID": 0, "Name": "三人两房" },
    { "ID": 13, "TopID": 0, "Name": "一房七张" },
    { "ID": 14, "TopID": 0, "Name": "幺鸡麻将" },
    { "ID": 15, "TopID": 0, "Name": "四川斗地主" },
    { "ID": 16, "TopID": 0, "Name": "四川斗地主(坨坨)" },
    { "ID": 17, "TopID": 0, "Name": "成都跑得快" },
    { "ID": 18, "TopID": 0, "Name": "老庄二鬼" },
    { "ID": 19, "TopID": 0, "Name": "疯子二鬼" },
    { "ID": 20, "TopID": 0, "Name": "眉山斗十四" },
    { "ID": 21, "TopID": 0, "Name": "明牌斗牛" },
    { "ID": 22, "TopID": 0, "Name": "三张牌" },
    { "ID": 23, "TopID": 0, "Name": "二人斗地主" },

    //眉山贰柒拾
    { "ID": 24, "TopID": 1, "Name": "0.5元", "Value": 5000 },
    { "ID": 25, "TopID": 1, "Name": "1元", "Value": 10000 },
    { "ID": 26, "TopID": 1, "Name": "2元", "Value": 20000 },
    { "ID": 27, "TopID": 1, "Name": "3元", "Value": 30000 },
    { "ID": 28, "TopID": 1, "Name": "4元", "Value": 40000 },
    { "ID": 29, "TopID": 1, "Name": "5元", "Value": 50000 },

    //乐山贰柒拾
    { "ID": 30, "TopID": 2, "Name": "0.5元", "Value": 5000 },
    { "ID": 31, "TopID": 2, "Name": "1元", "Value": 10000 },
    { "ID": 32, "TopID": 2, "Name": "2元", "Value": 20000 },
    { "ID": 33, "TopID": 2, "Name": "3元", "Value": 30000 },
    { "ID": 34, "TopID": 2, "Name": "4元", "Value": 40000 },
    { "ID": 35, "TopID": 2, "Name": "5元", "Value": 50000 },

    //犍为贰柒拾
    { "ID": 36, "TopID": 3, "Name": "0.5元", "Value": 5000 },
    { "ID": 37, "TopID": 3, "Name": "1元", "Value": 10000 },
    { "ID": 38, "TopID": 3, "Name": "2元", "Value": 20000 },
    { "ID": 39, "TopID": 3, "Name": "3元", "Value": 30000 },
    { "ID": 40, "TopID": 3, "Name": "4元", "Value": 40000 },
    { "ID": 41, "TopID": 3, "Name": "5元", "Value": 50000 },

    //十四张三人
    { "ID": 42, "TopID": 4, "Name": "0.3元", "Value": 3000 },
    { "ID": 43, "TopID": 4, "Name": "0.5元", "Value": 5000 },
    { "ID": 44, "TopID": 4, "Name": "0.8元", "Value": 8000 },
    { "ID": 45, "TopID": 4, "Name": "1元", "Value": 10000 },
    { "ID": 46, "TopID": 4, "Name": "2元", "Value": 20000 },
    { "ID": 47, "TopID": 4, "Name": "3元", "Value": 30000 },

    //十四张四人
    { "ID": 48, "TopID": 5, "Name": "0.3元", "Value": 3000 },
    { "ID": 49, "TopID": 5, "Name": "0.5元", "Value": 5000 },
    { "ID": 50, "TopID": 5, "Name": "0.8元", "Value": 8000 },
    { "ID": 51, "TopID": 5, "Name": "1元", "Value": 10000 },
    { "ID": 52, "TopID": 5, "Name": "2元", "Value": 20000 },
    { "ID": 53, "TopID": 5, "Name": "3元", "Value": 30000 },

    //十四张四人(血战)
    { "ID": 54, "TopID": 6, "Name": "0.5元", "Value": 5000 },
    { "ID": 55, "TopID": 6, "Name": "1元", "Value": 10000 },
    { "ID": 56, "TopID": 6, "Name": "2元", "Value": 20000 },
    { "ID": 57, "TopID": 6, "Name": "3元", "Value": 30000 },
    { "ID": 58, "TopID": 6, "Name": "4元", "Value": 40000 },
    { "ID": 59, "TopID": 6, "Name": "5元", "Value": 50000 },

    //眉山贰柒拾(犍为)
    { "ID": 60, "TopID": 7, "Name": "0.5元", "Value": 5000 },
    { "ID": 61, "TopID": 7, "Name": "1元", "Value": 10000 },
    { "ID": 62, "TopID": 7, "Name": "2元", "Value": 20000 },
    { "ID": 63, "TopID": 7, "Name": "3元", "Value": 30000 },
    { "ID": 64, "TopID": 7, "Name": "4元", "Value": 40000 },
    { "ID": 65, "TopID": 7, "Name": "5元", "Value": 50000 },

    //两人贰柒拾(乐山)
    { "ID": 66, "TopID": 8, "Name": "0.5元", "Value": 5000 },
    { "ID": 67, "TopID": 8, "Name": "1元", "Value": 10000 },
    { "ID": 68, "TopID": 8, "Name": "2元", "Value": 20000 },
    { "ID": 69, "TopID": 8, "Name": "3元", "Value": 30000 },
    { "ID": 70, "TopID": 8, "Name": "4元", "Value": 40000 },
    { "ID": 71, "TopID": 8, "Name": "5元", "Value": 50000 },

    //两人贰柒拾(眉山)
    { "ID": 72, "TopID": 9, "Name": "0.5元", "Value": 5000 },
    { "ID": 73, "TopID": 9, "Name": "1元", "Value": 10000 },
    { "ID": 74, "TopID": 9, "Name": "2元", "Value": 20000 },
    { "ID": 75, "TopID": 9, "Name": "3元", "Value": 30000 },
    { "ID": 76, "TopID": 9, "Name": "4元", "Value": 40000 },
    { "ID": 77, "TopID": 9, "Name": "5元", "Value": 50000 },

    //四川麻将
    { "ID": 78, "TopID": 10, "Name": "0.3元", "Value": 3000 },
    { "ID": 79, "TopID": 10, "Name": "0.5元", "Value": 5000 },
    { "ID": 80, "TopID": 10, "Name": "1元", "Value": 10000 },
    { "ID": 81, "TopID": 10, "Name": "2元", "Value": 20000 },
    { "ID": 82, "TopID": 10, "Name": "3元", "Value": 30000 },
    { "ID": 83, "TopID": 10, "Name": "5元", "Value": 50000 },

    //四川麻将(血流)
    { "ID": 84, "TopID": 11, "Name": "0.1元", "Value": 1000 },
    { "ID": 85, "TopID": 11, "Name": "0.3元", "Value": 3000 },
    { "ID": 86, "TopID": 11, "Name": "0.5元", "Value": 5000 },
    { "ID": 87, "TopID": 11, "Name": "0.8元", "Value": 8000 },
    { "ID": 88, "TopID": 11, "Name": "1元", "Value": 10000 },
    { "ID": 89, "TopID": 11, "Name": "2元", "Value": 20000 },

    //三人两房
    { "ID": 90, "TopID": 12, "Name": "0.3元", "Value": 3000 },
    { "ID": 91, "TopID": 12, "Name": "0.5元", "Value": 5000 },
    { "ID": 92, "TopID": 12, "Name": "1元", "Value": 10000 },
    { "ID": 93, "TopID": 12, "Name": "2元", "Value": 20000 },
    { "ID": 94, "TopID": 12, "Name": "3元", "Value": 30000 },
    { "ID": 95, "TopID": 12, "Name": "5元", "Value": 50000 },

    //一房七张
    { "ID": 96, "TopID": 13, "Name": "0.3元", "Value": 3000 },
    { "ID": 97, "TopID": 13, "Name": "0.5元", "Value": 5000 },
    { "ID": 98, "TopID": 13, "Name": "0.8元", "Value": 8000 },
    { "ID": 99, "TopID": 13, "Name": "1元", "Value": 10000 },
    { "ID": 100, "TopID": 13, "Name": "2元", "Value": 20000 },
    { "ID": 101, "TopID": 13, "Name": "3元", "Value": 30000 },

    //幺鸡麻将
    { "ID": 102, "TopID": 14, "Name": "0.2元", "Value": 2000 },
    { "ID": 103, "TopID": 14, "Name": "0.3元", "Value": 3000 },
    { "ID": 104, "TopID": 14, "Name": "0.5元", "Value": 5000 },
    { "ID": 105, "TopID": 14, "Name": "1元", "Value": 10000 },
    { "ID": 106, "TopID": 14, "Name": "2元", "Value": 20000 },
    { "ID": 107, "TopID": 14, "Name": "3元", "Value": 30000 },

    //四川斗地主
    { "ID": 108, "TopID": 15, "Name": "0.3元", "Value": 3000 },
    { "ID": 109, "TopID": 15, "Name": "0.5元", "Value": 5000 },
    { "ID": 110, "TopID": 15, "Name": "1元", "Value": 10000 },
    { "ID": 111, "TopID": 15, "Name": "2元", "Value": 20000 },
    { "ID": 112, "TopID": 15, "Name": "3元", "Value": 30000 },
    { "ID": 113, "TopID": 15, "Name": "5元", "Value": 50000 },

    //四川斗地主(坨坨)
    { "ID": 114, "TopID": 16, "Name": "0.1元", "Value": 1000 },
    { "ID": 115, "TopID": 16, "Name": "0.3元", "Value": 3000 },
    { "ID": 116, "TopID": 16, "Name": "0.5元", "Value": 5000 },
    { "ID": 117, "TopID": 16, "Name": "0.8元", "Value": 8000 },
    { "ID": 118, "TopID": 16, "Name": "1元", "Value": 10000 },
    { "ID": 119, "TopID": 16, "Name": "2元", "Value": 20000 },

    //成都跑得快
    { "ID": 120, "TopID": 17, "Name": "0.3元", "Value": 3000 },
    { "ID": 121, "TopID": 17, "Name": "0.5元", "Value": 5000 },
    { "ID": 122, "TopID": 17, "Name": "1元", "Value": 10000 },
    { "ID": 123, "TopID": 17, "Name": "2元", "Value": 20000 },
    { "ID": 124, "TopID": 17, "Name": "3元", "Value": 30000 },
    { "ID": 125, "TopID": 17, "Name": "5元", "Value": 50000 },

    //老庄二鬼
    { "ID": 126, "TopID": 18, "Name": "0.3元", "Value": 3000 },
    { "ID": 127, "TopID": 18, "Name": "0.5元", "Value": 5000 },
    { "ID": 128, "TopID": 18, "Name": "1元", "Value": 10000 },
    { "ID": 129, "TopID": 18, "Name": "2元", "Value": 20000 },
    { "ID": 130, "TopID": 18, "Name": "5元", "Value": 50000 },
    { "ID": 131, "TopID": 18, "Name": "10元", "Value": 100000 },

    //疯子二鬼
    { "ID": 132, "TopID": 19, "Name": "0.3元", "Value": 3000 },
    { "ID": 133, "TopID": 19, "Name": "0.5元", "Value": 5000 },
    { "ID": 134, "TopID": 19, "Name": "1元", "Value": 10000 },
    { "ID": 135, "TopID": 19, "Name": "2元", "Value": 20000 },
    { "ID": 136, "TopID": 19, "Name": "3元", "Value": 30000 },
    { "ID": 137, "TopID": 19, "Name": "5元", "Value": 50000 },

    //眉山斗十四
    { "ID": 138, "TopID": 20, "Name": "0.1元", "Value": 1000 },
    { "ID": 139, "TopID": 20, "Name": "0.3元", "Value": 3000 },
    { "ID": 140, "TopID": 20, "Name": "0.5元", "Value": 5000 },
    { "ID": 141, "TopID": 20, "Name": "0.8元", "Value": 8000 },
    { "ID": 142, "TopID": 20, "Name": "1元", "Value": 10000 },
    { "ID": 143, "TopID": 20, "Name": "2元", "Value": 20000 },

    //明牌斗牛
    { "ID": 144, "TopID": 21, "Name": "0.1元", "Value": 1000 },
    { "ID": 145, "TopID": 21, "Name": "0.3元", "Value": 3000 },
    { "ID": 146, "TopID": 21, "Name": "0.5元", "Value": 5000 },
    { "ID": 147, "TopID": 21, "Name": "0.8元", "Value": 8000 },
    { "ID": 148, "TopID": 21, "Name": "1元", "Value": 10000 },
    { "ID": 149, "TopID": 21, "Name": "2元", "Value": 20000 },

    //三张牌
    { "ID": 150, "TopID": 22, "Name": "0.2元", "Value": 2000 },
    { "ID": 151, "TopID": 22, "Name": "0.3元", "Value": 3000 },
    { "ID": 152, "TopID": 22, "Name": "0.5元", "Value": 5000 },
    { "ID": 153, "TopID": 22, "Name": "0.8元", "Value": 8000 },
    { "ID": 154, "TopID": 22, "Name": "1元", "Value": 10000 },
    { "ID": 155, "TopID": 22, "Name": "2元", "Value": 20000 },

    //二人斗地主
    { "ID": 156, "TopID": 23, "Name": "0.1元", "Value": 1000 },
    { "ID": 157, "TopID": 23, "Name": "0.3元", "Value": 3000 },
    { "ID": 158, "TopID": 23, "Name": "0.5元", "Value": 5000 },
    { "ID": 159, "TopID": 23, "Name": "0.8元", "Value": 8000 },
    { "ID": 160, "TopID": 23, "Name": "1元", "Value": 10000 },
    { "ID": 161, "TopID": 23, "Name": "2元", "Value": 20000 },
];
var blackGameInfo2 = [];
var gameRecInfo = [];
var blackGameMap = [];
initGameJsonData();
function initGameJsonData() {
    $.ajaxSettings.async = false;
    $.getJSON("/common/js/gameback.json?v=1.0.0", function (data) {
        $.each(eval(data), function (key, val) {
            blackGameInfo2.push(val);
            blackGameMap[key] = val;
        });
    });
    $.getJSON("/common/js/gamerec.json?v=1.0.0", function (data) {
        $.each(eval(data), function (key, val) {
            gameRecInfo.push(val);
        });
    });
    $.ajaxSettings.async = true;
}
function GetGameBlackModel(gameid) {
    if (gameid < 1) return null;
    for (var i = 0; i < blackGameInfo2.length; i++) {
        if (blackGameInfo2[i]["matchid"] == gameid) {
            return blackGameInfo2[i];
        }
    }
}
function GetGameName(gameid) {
    var gameModel = GetGameBlackModel(gameid);
    if (gameModel && gameModel != null)
        return gameModel.name;
    return "";
}
function GetGameBlackModelByType(gameType) {
    if (gameType == "") return null;
    gameType = gameType.toLowerCase();
    for (var i = 0; i < blackGameInfo2.length; i++) {
        if (blackGameInfo2[i]["type"].toLowerCase() == gameType) {
            return blackGameInfo2[i];
        }
    }
}
function GetGameNameByType(gameType) {
    if (gameType == "") return "";
    gameType = gameType.toLowerCase();
    var gameModel = GetGameBlackModelByType(gameType);
    if (gameModel && gameModel != null)
        return gameModel.name;
    return "";
} 
function GetGameRecModel(gameid) {
    if (gameid < 1) return null;
    for (var i = 0; i < gameRecInfo.length; i++) {
        if (gameRecInfo[i]["matchid"] == gameid) {
            return gameRecInfo[i];
        }
    }
}

function getBlackLevelStr(level) {
    if (!level || level == "") return "";
    level = level.toUpperCase();
    if (level == "LOW")
        return "低";
    else if (level == "MIDDLE")
        return "中";
    else if (level == "HIGH")
        return "高";
    return level;
}

function showInputVal(area) {
    if ($('#inputVal' + area).is(':checked')) {
        $("#valLi" + area).show();
        $("#tokenLi" + area).show();
    } else {
        $("#valLi" + area).hide();
        $("#tokenLi" + area).hide();
    }
}


function downGameLogData(gameid, chargeid, model, type) {
    var xhr = new XMLHttpRequest();
    var date = (new Date()).format("yyyyMMdd");
    var fileName = date + "_" + gameid + "_" + chargeid + "_" + (model == 1 ? "SHICHUI" : "ALL") + "_" + type + ".txt";
    xhr.open("POST", "/HandlerDownFile.ashx?gameid=" + gameid + "&chargeid=" + chargeid + "&model=" + model + "&type=" + type, true);
    xhr.responseType = "blob";
    xhr.onload = function () {
        if (this.status == 200) {
            var blob = this.response;
            var reader = new FileReader();
            reader.readAsDataURL(blob);
            reader.onload = function (e) {
                var a = document.createElement('a');
                a.download = fileName;
                a.href = e.target.result;
                if ($("#loading"))
                    $("#loading").hide();
                if (a.href.length < 10) {
                    alert("没有数据");
                    clearInterval(logTime);
                    return;
                }
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        }
    };
    xhr.send();
}
var logTime;
function downloadLog(o, type) {
    $("#loading").show();
    downGameLogData(o.GameId, o.ChargeId, type, "REC");
    logTime = setInterval(function () {
        downGameLogData(o.GameId, o.ChargeId, type, "LOG");
        clearInterval(logTime);
    }, 1000);
}


var oprObjTmp;
function setWinMoney(o) {
    oprObjTmp = o;
    showAddMoneyWin(2);
    $("#tgame2").text(games[o.GameId]);
    $("#tchargeid2").text(o.ChargeId);
    $("#keepVal").val(o.Money);
    $("#msgtitle").text("设置输赢值");
}
function setWinMoneyConfirm() {
    if (!oprObjTmp || oprObjTmp == null) {
        alert("数据错误，请重试");
        return;
    }
    var gameid = oprObjTmp.GameId;
    var gameInfo = GetGameBlackModel(gameid);
    if (gameInfo == null) return;
    var type = gameInfo.type;
    var account = oprObjTmp.Account;
    var chargeid = oprObjTmp.ChargeId;
    var token = $("#token2").val();
    var val = $('input:radio[name="gameval2"]:checked').val();
    if ($('#inputVal2').is(':checked')) {
        if (token == "") {
            $("#lblerr2").text("请输入安全令");
            return;
        }
        val = $("#tval2").val();
    }
    //请选择游戏
    if (type == "") {
        $("#lblerr2").text("游戏错误");
        return;
    }
    //else if (chargeid == "") {
    //    $("#lblerr2").text("请选择需要删除的游戏账号");
    //    return;
    //}
    //保留时val可为空
    ajax.setWinMoney("setwinnmoney", [gameid, account, type, chargeid, val, token], delwinresult);
}
function delwinresult(res) {
    $("#loading").hide();
    if (res.code == 1) {
        var oprAcc = oprObjTmp.Account.toUpperCase();
        var oprGameId = oprObjTmp.GameId;
        oprObjTmp = null;
        alert("操作成功");
        $('.theme-popover-mask').hide();
        $('.theme-popover').slideUp(200);
        var dataOld = jsonPager.data;
        var index = 0;
        for (var i = 0; i < dataOld.length; i++) {
            if (dataOld[i]["Account"].trim().toUpperCase() == oprAcc
                && dataOld[i]["GameId"].trim().toUpperCase() == oprGameId) {
                index = i;
                break;
            }
        }
        dataOld.splice(index, 1);
        jsonPager.data = dataOld;
        jsonPager.dataBind(res.index, dataOld.length);
    } else {
        if (res.msg != "")
            alert(res.msg);
        else
            alert("操作失败：" + res.code);
    }
}
function initValData(id, gameid, level) {
    $("#valTypeArea" + id).html("");
    var gameInfo = GetGameBlackModel(gameid);
    if (gameInfo == null) return;
    var isLow = "", isMiddle = "", isHigh = "";
    if (level && level != "") {
        if (level == "LOW") isLow = "checked";
        else if (level == "MIDDLE") isMiddle = "checked";
        else if (level == "HIGH") isHigh = "checked";
    }
    $("#valTypeArea" + id).append("<input type='radio' value='[" + gameInfo.low + "]' name='gameval' " + isLow + " /><label style='display:none'>LOW</label>低");
    $("#valTypeArea" + id).append("<input type='radio' value='[" + gameInfo.middle + "]' name='gameval' " + isMiddle + " /><label style='display:none'>MIDDLE</label>中");
    $("#valTypeArea" + id).append("<input type='radio' value='[" + gameInfo.high + "]' name='gameval' " + isHigh + " /><label style='display:none'>HIGH</label>高");
}
function initLevel(id) {
    $("#valTypeArea" + id).html("");
    $("#valTypeArea" + id).append("<input type='radio' value='1' name='gameval'/><label style='display:none'>LOW</label>低");
    $("#valTypeArea" + id).append("<input type='radio' value='2' name='gameval'/><label style='display:none'>MIDDLE</label>中");
    $("#valTypeArea" + id).append("<input type='radio' value='3' name='gameval'/><label style='display:none'>HIGH</label>高");
}
function addBlackUser() {
    showAddMoneyWin(4);
    initLevel(4);
    $("#msgtitle").text("添加游戏黑名单");
}
function addBlackUserConfirm() {
    var gameids = [];
    $("input:checkbox[name='chkGame']:checked").each(function () {
        if ($(this).val() > 0)
            gameids.push($(this).val());
    });
    if (gameids.length < 1) {
        $("#lblerr4").text("请选择游戏");
        return;
    }
    var chargeid = $("#tacc4").val();
    if (chargeid == "") {
        $("#lblerr4").text("请输入UID");
        return;
    }
    var level = $('input:radio[name="gameval"]:checked').val();
    if (level == "") {
        $("#lblerr4").text("请选择输赢值档位");
        return;
    }
    var levels = [];
    var levelStrs = [];
    for (var i = 0; i < gameids.length; i++) {
        var m = GetGameBlackModel(gameids[i]);
        if (m == null || (!m.low && !m.middle && !m.high) || (m.low == "" && m.middle == "" && m.high == "")) {
            levels.push([]);
            levelStrs.push("");
        }
        else {
            switch (level) {
                case "1":
                    levels.push(m.low);
                    levelStrs.push("LOW");
                    break;
                case "2":
                    levels.push(m.middle);
                    levelStrs.push("MIDDLE");
                    break;
                case "3":
                    levels.push(m.high);
                    levelStrs.push("HIGH");
                    break;
            }
        }
    }
    if (levels.length < 1 || levelStrs.length < 1) {
        $("#lblerr4").text("输赢值数据有误.");
        return;
    }
    var remark = $("#txtRemark4").val();
    if (!remark || remark == "") {
        $("#lblerr4").text("请输入备注");
        return;
    } 
    var gameidsStr = gameids.join("|");
    var levelsStr = levels.join("|");
    var levelStrsStr = levelStrs.join("|");
    var isConfirm = 0;
    if ($('#isConfirm').is(':checked'))
        isConfirm = 1;
    ajax.addBlackUser("addblackuser", [gameidsStr, chargeid, levelsStr, levelStrsStr, remark, isConfirm], addwinresult);
}
function addwinresult(res) {
    $("#loading").hide();
    if (res.code == 1) {
        alert("操作成功");
        $('.theme-popover-mask').hide();
        $('.theme-popover').slideUp(200);
    } else {
        if (res.msg != "")
            alert(res.msg);
        else
            alert("操作失败：" + res.code);
    }
}
var oprUpdateObj;
function updateBlackUser(o) {
    oprUpdateObj = o;
    showAddMoneyWin(1);
    initValData("", o.GameId, o.Level);
    $("#lblgame").text(GetGameName(o.GameId));
    $("#lblaccount").text(o.Account);
    $("#lblchargeid").text(o.ChargeId);
    $("#txtRemark").text(o.Remark);
    $("#msgtitle").text("修改黑名单用户");
}
function updateUserConfirm() {
    if (!oprUpdateObj || oprUpdateObj == null) {
        alert("操作有误");
        return;
    }
    var val = $('input:radio[name="gameval"]:checked').val();
    var levelStr = $('input:radio[name="gameval"]:checked').next("label").text();
    if ($('#inputVal1').is(':checked')) {
        val = "";
        if (token == "") {
            $("#lblerr").text("请输入安全令");
            return;
        }
        if ($("#tval11").val() != "" && $("#tval12").val() != "")
            val = "[" + $("#tval11").val() + "," + $("#tval12").val() + "]";
        //获取低中高的中文字符
        levelStr = "";
    }
    var gameid = oprUpdateObj.GameId;
    var acc = oprUpdateObj.Account;
    var chargeid = oprUpdateObj.ChargeId;
    var remark = $("#txtRemark").val();
    var token = $("#token").val();
    if (gameid == "" || parseInt(gameid) < 1 || acc == "" || chargeid == "") {
        $("#lblerr").text("参数错误");
        return;
    }
    else if (!val || val == "") {
        $("#lblerr").text("请设置值");
        return;
    }
    else if (!remark || remark == "") {
        $("#lblerr").text("请输入备注");
        return;
    }
    ajax.updateBlackUser("updateblackuser", [gameid, acc, chargeid, val, levelStr, remark, token], updatewinresult);
}
function updatewinresult(res) {
    $("#loading").hide();
    if (res.code == 1) {
        var oprAcc = oprUpdateObj.Account.toUpperCase();
        var oprGameId = oprUpdateObj.GameId;
        oprUpdateObj = null;
        alert("操作成功");
        $('.theme-popover-mask').hide();
        $('.theme-popover').slideUp(200);
        var dataOld = jsonPager.data;
        var newModel = res.msg;
        var oldModel;
        var index = 0;
        for (var i = 0; i < dataOld.length; i++) {
            if (dataOld[i]["Account"].trim().toUpperCase() == oprAcc && dataOld[i]["GameId"].trim().toUpperCase() == oprGameId) {
                oldModel = dataOld[i];
                index = i;
                break;
            }
        }
        oldModel["Value"] = newModel["Value"];
        oldModel["Level"] = newModel["Level"];
        oldModel["Remark"] = newModel["Remark"];
        dataOld[index] = oldModel;
        jsonPager.data = dataOld;
        jsonPager.dataBind(res.index, dataOld.length);
    } else {
        if (res.msg != "")
            alert(res.msg);
        else
            alert("操作失败：" + res.code);
    }
}
function getGameMoney(o) {
    var gameInfo = GetGameBlackModel(o.GameId);
    if (gameInfo == null) return;
    ajax.getUserGameMoney([o.ChargeId, gameInfo.type], function (res) {
        if (res.code == 1) {
            showAddMoneyWin(5);
            $("#lblgame5").text(GetGameName(o.GameId));
            $("#lblaccount5").text(o.Account);
            $("#lblchargeid5").text(o.ChargeId);
            $("#lblMoney5").text(res.msg);
            $("#lblRemark5").text(o.Remark);
        } else
            alert("获取游戏输赢值出错");
    });
    $("#msgtitle").text("查看玩家输赢值");
}
function checkAll(o) {
    if (o.checked) {
        $("input:checkbox[name='chkGame']").each(function () {
            this.checked = true;
        });
    } else {
        $("input:checkbox[name='chkGame']:checked").each(function () {
            this.checked = false;
        });
    }
}
function initNick(nickList) {
    if (nickList == "") {
        return "";
    }
    var nickArr = nickList.split(",");
    var list = "";
    for (var j = 0; j < nickArr.length; j++) {
        var nick = getEmoji(nickArr[j]);
        list += nick + "</br>";
    }
    return list;
}

function getEmoji(nick) {
    if (nick == "") {
        return "";
    }
    if (nick.indexOf("\\U000") >= 0) {
        var nicks = nick.split(" ");
        var newNick = "";
        for (var i = 0; i < nicks.length; i++) {
            var emojiIndex = nicks[i].indexOf("\\U000");
            if (emojiIndex >= 0) {
                var before = nicks[i].substring(0, emojiIndex) || "";
                var emojiTmp = nicks[i].substring(emojiIndex, emojiIndex + 10);
                var emojiStr = emojiTmp.replace("\\U000", "0x");
                var emoji = String.fromCodePoint(emojiStr) || "";
                var after = nicks[i].substring(emojiIndex + 10) || "";
                newNick += before + emoji + after + " ";
            } else
                newNick += nicks[i] + " ";
        }
        return newNick;
    }
    else {
        return nick;
    }
}
//输赢值异常设置
var oprGameType;
var oprGameValue;
function setRedAlert() {
    showAddMoneyWin(1);
    $("#msgtitle").text("设置预警输赢值");
}
function setRedAlertConfirm() {
    var type = $("#game1").val();
    var val = $("#value").val();
    if (!type || type == "") {
        $("#lblerr").text("请选择游戏");
        return;
    } else if (!val || val == "" || parseInt(val) < -1) {
        $("#lblerr").text("请输入设置值");
        return;
    }
    oprGameType = type;
    oprGameValue = val;
    ajax.setRedAlert("setredalert", [type, val], setwinresult);
}
function setwinresult(res) {
    $("#loading").hide();
    if (res.code == 1) {
        alert("操作成功");
        $('.theme-popover-mask').hide();
        $('.theme-popover').slideUp(200);
        var dataOld = jsonPager.data;
        dataOld.push({ "type": oprGameType, "value": oprGameValue });
        oprGameType = null;
        oprGameValue = null;
        jsonPager.data = dataOld;
        jsonPager.dataBind(res.index, dataOld.length);
    } else {
        if (res.msg != "")
            alert(res.msg);
        else
            alert("操作失败：" + res.code);
    }
}


function searchAlertConfig() {
    var pagerTitles = ["游戏", "值", "操作"];
    jsonPager.init(ajax.getRedAlert, [], searchAlertConfigResult, pagerTitles, "list_table", "container", "pager", insertAlertConfigRow);
    jsonPager.dataBind(1, 0);

    $("#loading").show();
    jsonPager.queryArgs = [];
    jsonPager.pageSize = 1000;
    ajax.getRedAlert(jsonPager.makeArgs(1), searchAlertConfigResult);
}


function searchAlertConfigResult(data) {
    $("#loading").hide();
    if (data.code == 1) {
        var newResult = [];
        for (var key in data.result) {
            newResult.push({ "type": key, "value": data.result[key] });
        }
        jsonPager.data = newResult;
        jsonPager.dataBind(data.index, data.rowCount);
    } else {
        alert(data.msg);
    }
}
function insertAlertConfigRow(o, tr) {
    addCell = function (tr, text, i) {
        var td = tr.insertCell(i);
        td.innerHTML = text;
    };
    addCell(tr, GetGameNameByType(o.type), 0);
    addCell(tr, o.value, 1);
    addCell(tr, "<a href='javascript:;' onclick='delRedAlert(\"" + o.type + "\")'>删除</a>", 2);
    return tr;
}
function delRedAlert(gameType) {
    oprGameType = gameType;
    ajax.setRedAlert("delredalert", [gameType], delalertwinresult);
}

function delalertwinresult(res) {
    $("#loading").hide();
    if (res.code == 1) {
        alert("操作成功");
        var dataOld = jsonPager.data;
        var index = 0;
        for (var i = 0; i < dataOld.length; i++) {
            if (dataOld[i]["type"].trim().toUpperCase() == oprGameType) {
                index = i;
                break;
            }
        }
        dataOld.splice(index, 1);
        oprGameType = null;
        jsonPager.data = dataOld;
        jsonPager.dataBind(res.index, dataOld.length);
    } else {
        if (res.msg != "")
            alert(res.msg);
        else
            alert("操作失败：" + res.code);
    }
}